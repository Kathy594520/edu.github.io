<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ä¼Šå¡å“‡å¿ƒæƒ…å„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #ffe6f0;
            background-image: 
                radial-gradient(#ffb3d9 2px, transparent 2px),
                radial-gradient(#ffffff 2px, transparent 2px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
        }
        .soft-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 5px solid #fff;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.25);
            border-radius: 40px;
        }
        .chiikawa-btn {
            border: 4px solid #fff;
            box-shadow: 0 6px 0px rgba(255, 182, 193, 0.6);
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 10;
            cursor: pointer;
        }
        .chiikawa-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0px 0px rgba(255, 182, 193, 0.6);
        }
        .btn-selected {
            transform: translateY(4px);
            box-shadow: 0 0px 0px rgba(255, 182, 193, 0.6) !important;
            filter: brightness(0.95);
            background-color: #fce7f3; 
        }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }
        .animate-float { animation: float 4s ease-in-out infinite; }
        @keyframes bounce-x { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }
        .animate-bounce-x { animation: bounce-x 1s infinite; }
        .gauge-wrapper { position: relative; width: 260px; height: 130px; margin: 0 auto; overflow: hidden; }
        .gauge-bg {
            width: 260px; height: 260px; border-radius: 50%;
            background: conic-gradient(from 270deg, #60a5fa 0deg 45deg, #4ade80 45deg 90deg, #facc15 90deg 135deg, #f87171 135deg 180deg);
            position: absolute; top: 0; left: 0;
            -webkit-mask-image: radial-gradient(transparent 55%, black 56%);
            mask-image: radial-gradient(transparent 55%, black 56%);
            border: 6px solid white; box-sizing: border-box;
        }
        .gauge-pointer {
            position: absolute; bottom: 0; left: 50%; width: 4px; height: 110px;
            background: transparent; transform-origin: bottom center;
            transform: rotate(-90deg); transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 10;
        }
        .gauge-pointer::after {
            content: 'ğŸ’–'; font-size: 32px; position: absolute; top: -15px; left: 50%;
            transform: translateX(-50%) rotate(180deg); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        .gauge-center-cap {
            position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 20px; background: white; border-radius: 50%; z-index: 11;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .mood-list-container { max-height: 500px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #fbcfe8 #fff; }
        .perspective-1000 { perspective: 1000px; }
        .card-container { position: relative; width: 100%; height: 100%; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.8s; transform-style: preserve-3d; }
        .card-container.flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; border-radius: 1.5rem; top: 0; left: 0; overflow: hidden; }
        .card-front-face { transform: rotateY(180deg); }
        .card-back-face { z-index: 2; }
        @keyframes pop-in { 0% { opacity: 0; transform: translateY(20px) scale(0.95); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
        .animate-pop-in { animation: pop-in 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        .hidden { display: none; }
        html { scroll-behavior: smooth; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        .writing-mode-vertical-rl { writing-mode: vertical-rl; }
        .emotion-btn-group { opacity: 0; max-height: 0; overflow: hidden; transition: all 0.4s ease-in-out; }
        .emotion-btn-group.visible { opacity: 1; max-height: 600px; }
    </style>
</head>
<body class="text-slate-700 h-screen overflow-hidden flex flex-col">
    
    <div class="fixed top-6 left-4 z-50 flex items-center gap-3">
        <button id="toggle-view-btn" class="chiikawa-btn bg-indigo-500 text-white rounded-full p-3 pr-5 hover:bg-indigo-600 transition-all shadow-lg flex items-center gap-2 group" title="åˆ‡æ›è¦–åœ–">
            <div class="bg-white/20 p-1 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg></div>
            <span class="font-bold text-sm tracking-wide">åˆ‡æ›ï¼šçœ‹å¤§å®¶ / è¨˜å¿ƒæƒ…</span>
        </button>
        <div id="toggle-hint" class="bg-yellow-300 text-yellow-900 px-3 py-1.5 rounded-xl font-bold text-sm shadow-md animate-bounce-x border-2 border-white relative pointer-events-none">
            ğŸ‘ˆ é»é€™è£¡åˆ‡æ›ç•«é¢å–”ï¼
            <div class="absolute top-1/2 -left-2 -translate-y-1/2 w-0 h-0 border-t-8 border-t-transparent border-r-[10px] border-r-yellow-300 border-b-8 border-b-transparent"></div>
        </div>
    </div>

    <div class="fixed top-6 right-20 z-50">
        <button id="admin-login-btn" class="chiikawa-btn bg-slate-100 text-slate-500 rounded-full p-2 hover:bg-slate-200 transition-all shadow-md" title="è€å¸«å°ˆç”¨ç™»å…¥/ç™»å‡º">
            <svg id="icon-locked" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
            <svg id="icon-unlocked" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z" /></svg>
        </button>
    </div>

    <button id="manual-draw-btn" class="chiikawa-btn fixed top-6 right-4 z-40 bg-white text-pink-500 rounded-full p-2 hover:bg-pink-50 transition-all shadow-lg" title="æŠ½å¼µç¥ç¦å¡"><span class="text-xl">ğŸ’–</span></button>

    <a href="https://kathy594520.github.io/new.github.io/AI/AI" target="_blank" class="animate-float fixed bottom-6 right-6 z-50 bg-white/90 backdrop-blur-sm border-2 border-pink-300 text-pink-500 px-5 py-2.5 rounded-full shadow-[0_4px_15px_rgba(244,114,182,0.4)] hover:scale-105 hover:bg-pink-50 transition-all text-sm font-bold flex items-center gap-2 group decoration-none">
        <span class="text-lg group-hover:rotate-12 transition-transform">ğŸŒ¸</span> <span>ä»™å§‘å‡±è¥¿è¨­è¨ˆ</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
    </a>

    <div class="flex-1 overflow-y-auto z-10" id="main-scroll-area">
        <div class="container mx-auto px-4 py-6 max-w-5xl mt-12">
            <div class="mb-6 rounded-[40px] overflow-hidden shadow-2xl border-8 border-white transform hover:scale-[1.01] transition-transform duration-500">
                 <img src="header.jpg" alt="Chiikawa Mood Cards" class="w-full h-auto object-cover block">
            </div>

            <div id="main-layout-container">
                <div id="input-panel">
                    <div class="space-y-6">
                        <div class="soft-card p-6 sm:p-10 relative overflow-hidden">
                            <div class="text-center mb-6 relative z-10">
                                <h1 class="text-3xl sm:text-4xl font-black text-slate-700 mb-2 tracking-tight">ä»Šå¤©å¿ƒæƒ…æ€éº¼æ¨£ï¼Ÿ</h1>
                                <p class="text-slate-500 font-bold bg-white/50 inline-block px-6 py-2 rounded-full border border-white">è¨˜éŒ„ä¸‹ä¾†ï¼Œè®“å°å¯æ„›å€‘é™ªä½ ä¸€èµ·é¢å°</p>
                            </div>
                            
                            <form id="emotion-form" class="relative z-10">
                                <div>
                                    <label class="font-bold text-lg text-slate-700 mb-3 block flex items-center gap-2"><span class="bg-pink-400 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm shadow-md font-black">1</span>ä½ ç¾åœ¨åœ¨å“ªå€‹å€åŸŸï¼Ÿ</label>
                                    <div id="zone-options" class="grid grid-cols-2 gap-4"></div>
                                    <input type="hidden" id="zone-type-input" name="zone-type">
                                </div>

                                <div class="bg-pink-50/50 rounded-3xl p-4 mt-6 border-2 border-white text-center">
                                    <h3 class="text-sm font-bold text-pink-400 mb-2">âœ¨ å€‹äººå°ˆå±¬å¿ƒæƒ…å„€è¡¨æ¿ âœ¨</h3>
                                    <div class="gauge-wrapper transform scale-90"><div class="gauge-bg"></div><div class="gauge-pointer" id="personal-gauge-pointer"></div><div class="gauge-center-cap"></div></div>
                                    <p id="personal-gauge-text" class="text-sm font-bold text-slate-400 transition-colors">è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•ï¼Œçœ‹çœ‹æŒ‡é‡æœƒè½‰å»å“ªè£¡ï¼</p>
                                </div>
                                
                                <div class="mt-6 grid lg:grid-cols-2 lg:gap-8 items-start">
                                    <div id="emotion-selection-container"></div>
                                    <div class="space-y-5 mt-6 lg:mt-0 bg-white/60 p-6 rounded-3xl border-4 border-white">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 h-full"> 
                                            <div class="flex flex-col"><label for="student-name" class="font-bold text-slate-700 mb-2 flex items-center gap-2"><span class="bg-pink-400 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm shadow-md font-black">2</span>åå­—/åº§è™Ÿï¼š</label><input type="text" id="student-name" class="w-full p-3 bg-white border-2 border-pink-200 rounded-2xl focus:ring-4 focus:ring-pink-200 focus:border-pink-400 transition-all outline-none text-slate-700 font-bold text-lg text-center placeholder-pink-200 flex-1" placeholder="ä¾‹å¦‚ï¼šå°å…«è²“"></div>
                                            <div class="flex flex-col"><label for="reason-input" class="font-bold text-slate-700 mb-2 flex items-center gap-2"><span class="bg-pink-400 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm shadow-md font-black">3</span>ç™¼ç”Ÿäº†ä»€éº¼ï¼Ÿ</label><textarea id="reason-input" rows="3" class="w-full p-3 bg-white border-2 border-pink-200 rounded-2xl focus:ring-4 focus:ring-pink-200 focus:border-pink-400 transition-all outline-none placeholder-pink-200 resize-none flex-1" placeholder="åƒæ˜¯ï¼šåƒåˆ°å¥½åƒçš„æ‹‰éºµ..."></textarea></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-8">
                                    <p id="error-message" class="text-red-500 text-sm h-6 mb-2 text-center font-bold"></p>
                                    <button type="submit" id="submit-btn" class="chiikawa-btn w-full bg-gradient-to-r from-pink-400 to-rose-400 text-white font-black text-xl py-4 px-6 rounded-2xl hover:from-pink-500 hover:to-rose-500 active:scale-[0.98] transition-all flex items-center justify-center gap-3 shadow-xl shadow-pink-200"><span>é€å‡ºå¿ƒæƒ…ï¼ŒæŠ½å–ç¥ç¦</span> <span class="animate-bounce">âœ¨</span></button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="mb-12">
                            <details class="bg-white/90 border-4 border-white rounded-3xl shadow-sm p-5 cursor-pointer group hover:bg-white transition-colors">
                                <summary class="font-bold text-lg text-slate-700 flex justify-between items-center select-none"><span class="flex items-center gap-2">ğŸ“˜ <span class="border-b-4 border-yellow-200">ä»€éº¼æ˜¯æƒ…ç·’å››è‰²å€ï¼Ÿ</span></span><svg class="chevron w-6 h-6 text-pink-300 group-hover:text-pink-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path></svg></summary>
                                <div id="guide-container" class="mt-6 grid gap-4 sm:grid-cols-2 pt-4 border-t border-pink-100"></div>
                            </details>
                        </div>
                    </div>
                </div>

                <div id="quadrant-panel" class="hidden relative h-full">
                    <div class="relative flex justify-center items-center mb-4 lg:mt-0 gap-4">
                        <h2 class="text-2xl font-black text-center text-slate-700 bg-white border-2 border-pink-200 px-8 py-3 rounded-full shadow-sm">å¤§å®¶çš„å¿ƒæƒ…å„€è¡¨æ¿</h2>
                        <button id="clear-all-btn" class="chiikawa-btn hidden bg-red-400 text-white p-3 rounded-full hover:bg-red-500 transition-colors shadow-lg" title="æ¸…ç©ºå…¨ç­è³‡æ–™ (è€å¸«å°ˆç”¨)"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                    </div>
                    
                    <div class="soft-card p-4 min-h-[80vh] border-4 border-white flex flex-col">
                        <div class="w-full bg-white/50 rounded-3xl p-6 mb-4 flex flex-col items-center justify-center border-2 border-white">
                            <div class="gauge-wrapper"><div class="gauge-bg"></div><div class="gauge-pointer" id="main-gauge-pointer"></div><div class="gauge-center-cap"></div></div>
                            <p class="text-center text-slate-500 font-bold text-sm bg-white px-4 py-1 rounded-full shadow-sm mt-2">æ„›å¿ƒæŒ‡é‡æœƒæŒ‡å‘å¤§å®¶æœ€æ–°çš„å¿ƒæƒ…å–”ï¼</p>
                            <div class="mt-6 w-full max-w-sm space-y-3">
                                <h4 class="text-center text-slate-400 font-black text-xs uppercase tracking-widest mb-1">ğŸ“Š èƒ½é‡çµ±è¨ˆç«™</h4>
                                <div class="flex items-center gap-2 text-xs font-bold text-slate-600"><span class="w-16 text-right">æ°£å™—å™—</span><div class="flex-1 h-3 bg-white rounded-full overflow-hidden border border-pink-100 shadow-inner"><div id="bar-red" class="h-full bg-red-400 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div><span id="count-red" class="w-6 text-left font-black text-red-400">0</span></div>
                                <div class="flex items-center gap-2 text-xs font-bold text-slate-600"><span class="w-16 text-right">äº®æ™¶æ™¶</span><div class="flex-1 h-3 bg-white rounded-full overflow-hidden border border-pink-100 shadow-inner"><div id="bar-yellow" class="h-full bg-yellow-400 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div><span id="count-yellow" class="w-6 text-left font-black text-yellow-500">0</span></div>
                                <div class="flex items-center gap-2 text-xs font-bold text-slate-600"><span class="w-16 text-right">æ¿•æ­æ­</span><div class="flex-1 h-3 bg-white rounded-full overflow-hidden border border-pink-100 shadow-inner"><div id="bar-blue" class="h-full bg-blue-400 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div><span id="count-blue" class="w-6 text-left font-black text-blue-400">0</span></div>
                                <div class="flex items-center gap-2 text-xs font-bold text-slate-600"><span class="w-16 text-right">è»Ÿç¶¿ç¶¿</span><div class="flex-1 h-3 bg-white rounded-full overflow-hidden border border-pink-100 shadow-inner"><div id="bar-green" class="h-full bg-green-400 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div><span id="count-green" class="w-6 text-left font-black text-green-500">0</span></div>
                            </div>
                        </div>

                        <div id="emotion-lists" class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
                            <div class="bg-red-50/80 rounded-2xl p-3 border-2 border-red-100 flex flex-col max-h-[300px]"><h3 class="font-black text-red-500 mb-2 flex items-center gap-2 bg-white/80 p-2 rounded-xl shadow-sm"><span>ğŸ”¥</span> æ°£å™—å™—ç«å±± <span class="text-xs bg-red-100 px-2 py-0.5 rounded text-red-400 ml-auto">åœä¸‹ä¾†</span></h3><div id="list-red" class="space-y-2 overflow-y-auto pr-1 flex-1"></div></div>
                            <div class="bg-yellow-50/80 rounded-2xl p-3 border-2 border-yellow-100 flex flex-col max-h-[300px]"><h3 class="font-black text-yellow-500 mb-2 flex items-center gap-2 bg-white/80 p-2 rounded-xl shadow-sm"><span>âœ¨</span> äº®æ™¶æ™¶æ˜Ÿæ˜Ÿ <span class="text-xs bg-yellow-100 px-2 py-0.5 rounded text-yellow-500 ml-auto">æ…¢ä¸€é»</span></h3><div id="list-yellow" class="space-y-2 overflow-y-auto pr-1 flex-1"></div></div>
                            <div class="bg-blue-50/80 rounded-2xl p-3 border-2 border-blue-100 flex flex-col max-h-[300px]"><h3 class="font-black text-blue-500 mb-2 flex items-center gap-2 bg-white/80 p-2 rounded-xl shadow-sm"><span>â˜”</span> æ¿•æ­æ­é›¨å¤© <span class="text-xs bg-blue-100 px-2 py-0.5 rounded text-blue-400 ml-auto">ä¼‘æ¯å–”</span></h3><div id="list-blue" class="space-y-2 overflow-y-auto pr-1 flex-1"></div></div>
                            <div class="bg-green-50/80 rounded-2xl p-3 border-2 border-green-100 flex flex-col max-h-[300px]"><h3 class="font-black text-green-500 mb-2 flex items-center gap-2 bg-white/80 p-2 rounded-xl shadow-sm"><span>ğŸ€</span> è»Ÿç¶¿ç¶¿è‰åœ° <span class="text-xs bg-green-100 px-2 py-0.5 rounded text-green-500 ml-auto">å‰é€²å§</span></h3><div id="list-green" class="space-y-2 overflow-y-auto pr-1 flex-1"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-8 mb-24 text-center py-6 text-slate-400 text-xs sm:text-sm font-medium">
            <div class="container mx-auto px-4"><span>Â© 2025 ä»™å§‘å‡±è¥¿çš„å‰ä¼Šå¡å“‡å¿ƒæƒ…å„€è¡¨æ¿ . Built with Gemini AI.</span></div>
        </footer>
    </div>

    <div id="rainbow-card-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="relative w-full max-w-xs perspective-1000">
            <button id="close-card-btn" class="absolute -top-12 right-0 bg-white text-slate-700 hover:text-pink-500 p-2 rounded-full shadow-lg transition-colors border-2 border-pink-100 z-50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></button>
            <div id="card-container" class="card-container w-full aspect-[3/4] relative cursor-pointer">
                <div class="card-inner">
                    <div class="card-face card-back-face shadow-2xl flex flex-col items-center justify-center p-6 bg-gradient-to-br from-pink-300 via-purple-300 to-indigo-300 border-4 border-white"><div class="w-32 h-32 bg-white/30 rounded-full flex items-center justify-center mb-4 backdrop-blur-sm border-2 border-white/50"><span class="text-6xl">ğŸ</span></div><h3 class="text-2xl font-black text-white mb-2 tracking-wide drop-shadow-md">ä½ çš„ç¥ç¦</h3><p class="text-white font-bold bg-white/20 px-4 py-1 rounded-full text-sm">é»æ“Šç¿»é–‹</p></div>
                    <div class="card-face card-front-face shadow-2xl bg-white border-8 border-white overflow-hidden flex flex-col">
                        <div id="card-header-bg" class="h-28 bg-pink-100 flex items-center justify-center relative"><div class="absolute -bottom-8 w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md border-4 border-white"><span id="card-icon" class="text-3xl">âœ¨</span></div></div>
                        <div class="flex-1 flex flex-col items-center justify-center p-6 text-center pt-10"><h4 id="card-title" class="text-lg font-black text-slate-700 mb-3">çµ¦å°å¯æ„›çš„å»ºè­°</h4><p id="card-message" class="text-base text-slate-600 leading-relaxed font-bold" style="white-space: pre-wrap;">ç¨å¾®ä¼‘æ¯ä¸€ä¸‹ï¼Œåƒé»ç”œé»å§ï¼</p></div>
                        <div class="p-4 bg-slate-50 flex justify-center gap-4"><button id="read-card-btn" class="chiikawa-btn flex items-center gap-2 text-indigo-500 bg-white hover:bg-indigo-50 transition-colors text-sm font-bold px-4 py-2 rounded-full border border-indigo-100"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>è½è½çœ‹</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… è«‹æŠŠé€™è£¡æ›æˆæ‚¨çš„ã€ŒChiikawa00ã€è©¦ç®—è¡¨çš„ GAS ç¶²å€ (é€™ä»½æ˜¯å‰¯æœ¬02å°ˆç”¨) â˜…â˜…â˜…
        const GAS_API_URL = https://script.google.com/macros/s/AKfycbyP8fxSQAKfhKn_orUmZlDOg_cLEmNlDTq8DsG9MXY1jI5UuS2FRwWRDbkZm-fUy-o6aw/exec""; // <--- è«‹è²¼ä¸Šæ–°ç¶²å€
        
        // --- ç®¡ç†å“¡å¯†ç¢¼ ---
        const ADMIN_PASSWORD = "8888"; 

        // ... (ä»¥ä¸‹ç¨‹å¼ç¢¼é‚è¼¯èˆ‡ä¸Šä¸€ä»½å®Œå…¨ç›¸åŒï¼Œçœç•¥ä»¥ç¯€çœç¯‡å¹…ï¼Œè«‹ç›´æ¥ä½¿ç”¨ä¸Šæ–¹å®Œæ•´ä»£ç¢¼) ...
        // å®Œæ•´ç¨‹å¼ç¢¼è«‹åƒç…§ä¸Šæ–¹å›æ‡‰ï¼Œåªéœ€è¦ä¿®æ”¹ GAS_API_URL å³å¯
        
        // ç‚ºäº†æ–¹ä¾¿ï¼Œé€™é‚Šè£œä¸Šå®Œæ•´çš„ JS å€å¡Šï¼Œè®“æ‚¨ç›´æ¥è¤‡è£½
        
        // æƒ…ç·’è³‡æ–™èˆ‡å½©è™¹å¡ (å®Œæ•´)
        const emotionZones = [{id:'red',name:'æ°£å™—å™—ç«å±±',action:'STOP',description:'èƒ½é‡è¶…ç´šæ»¿ï¼åƒæ˜¯ç†±é–‹æ°´ä¸€æ¨£æ»¾ç‡™ï¼Œéœ€è¦åœä¸‹ä¾†å¹æ¶¼ã€‚',color:'bg-red-50 border-red-200',textColor:'text-red-500',selectedColor:'bg-red-400 text-white border-red-400 shadow-lg shadow-red-200',emotions:[{id:'angry',name:'ç”Ÿæ°£'},{id:'nervous',name:'ç·Šå¼µ'},{id:'scared',name:'å®³æ€•'},{id:'annoyed',name:'ç…©èº'},{id:'frustrated',name:'æŒ«æŠ˜'},{id:'other',name:'å…¶ä»–'}]},{id:'yellow',name:'äº®æ™¶æ™¶æ˜Ÿæ˜Ÿ',action:'SLOW',description:'èƒ½é‡å¾ˆé«˜ï¼åƒæ˜¯å–äº†æ±½æ°´ä¸€æ¨£èˆˆå¥®ï¼Œä½†è¦è¨˜å¾—æ…¢æ…¢ä¾†å–”ã€‚',color:'bg-yellow-50 border-yellow-200',textColor:'text-yellow-600',selectedColor:'bg-yellow-400 text-white border-yellow-400 shadow-lg shadow-yellow-200',emotions:[{id:'happy',name:'é–‹å¿ƒ'},{id:'excited',name:'èˆˆå¥®'},{id:'playful',name:'èª¿çš®'},{id:'confident',name:'å¾—æ„'},{id:'surprised',name:'é©šå–œ'},{id:'other',name:'å…¶ä»–'}]},{id:'blue',name:'æ¿•æ­æ­é›¨å¤©',action:'REST',description:'èƒ½é‡ä½ä½çš„ï¼Œåƒæ˜¯é›»æ± æ²’é›»äº†ï¼Œéœ€è¦æŠ±æŠ±å’Œä¼‘æ¯ã€‚',color:'bg-blue-50 border-blue-200',textColor:'text-blue-500',selectedColor:'bg-blue-400 text-white border-blue-400 shadow-lg shadow-blue-200',emotions:[{id:'sad',name:'é›£é'},{id:'tired',name:'ç´¯ç´¯'},{id:'bored',name:'ç„¡èŠ'},{id:'lonely',name:'å­¤å–®'},{id:'disappointed',name:'å¤±æœ›'},{id:'other',name:'å…¶ä»–'}]},{id:'green',name:'è»Ÿç¶¿ç¶¿è‰åœ°',action:'GO',description:'èƒ½é‡å‰›å‰›å¥½ï¼Œåƒæ˜¯èººåœ¨é›²æœµä¸Šä¸€æ¨£èˆ’æœã€å¹³éœã€‚',color:'bg-green-50 border-green-200',textColor:'text-green-600',selectedColor:'bg-green-400 text-white border-green-400 shadow-lg shadow-green-200',emotions:[{id:'calm',name:'å¹³éœ'},{id:'relaxed',name:'æ”¾é¬†'},{id:'focused',name:'å°ˆæ³¨'},{id:'safe',name:'å®‰å¿ƒ'},{id:'grateful',name:'æ„Ÿè¬'},{id:'other',name:'å…¶ä»–'}]}];
        const rainbowCards = {red:{color:"from-red-300 to-pink-400",icon:"ğŸµ",messages:["æ·±å‘¼å¸ï¼Œåƒå¹æ¶¼ç†±èŒ¶ä¸€æ¨£ï¼Œå‘¼ï½","æš«åœä¸€ä¸‹ï¼Œå»çœ‹çœ‹çª—å¤–çš„å¤©ç©ºå§ã€‚","æ…¢æ…¢æ•¸åˆ°åï¼Œè®“å¿ƒè·³è·Ÿè‘—ç¯€å¥æ…¢ä¸‹ä¾†ã€‚","ä½ å¯ä»¥ç”Ÿæ°£ï¼Œä½†è¦è¨˜å¾—ä¿è­·è‡ªå·±ä¸å—å‚·å–”ã€‚","å»å–æ¯æ°´ï¼Œæ„Ÿè¦ºæ°´çš„æº«åº¦æµéå–‰åš¨ã€‚","æŠŠé›™è…³è¸©åœ¨åœ°ä¸Šï¼Œæ„Ÿå—åœ°æ¿ç©©ç©©åœ°æ’è‘—ä½ ã€‚","æƒ³åƒä½ æ˜¯å€‹æ°£çƒï¼ŒæŠŠç”Ÿæ°£çš„æ°£æ…¢æ…¢æ”¾æ‰ã€‚","æ‰¾ä¸€å€‹å®‰éœçš„è§’è½ï¼Œèº²ä¸€ä¸‹ä¹Ÿæ²’é—œä¿‚å–”ã€‚","ç”¨åŠ›æ¡ç·Šæ‹³é ­ï¼Œç„¶å¾Œæ…¢æ…¢æ”¾é¬†ï¼Œåƒæœå‡ä¸€æ¨£ã€‚","é–‰ä¸Šçœ¼ç›ï¼Œæƒ³åƒä¸€å€‹ä½ æœ€å–œæ­¡çš„é¡è‰²ã€‚","å»æ´—æŠŠè‡‰ï¼Œè®“æ°´å¸¶èµ°ç†±ç†±çš„æ„Ÿè¦ºã€‚","ç”¨é›™æ‰‹æŠ±æŠ±è‡ªå·±ï¼Œè·Ÿè‡ªå·±èªªè²è¾›è‹¦äº†ã€‚","é€™åªæ˜¯ä¸€å€‹æš«æ™‚çš„æ„Ÿè¦ºï¼Œåƒé›²ä¸€æ¨£æœƒé£„èµ°çš„ã€‚","æŠŠè®“ä½ ä¸é–‹å¿ƒçš„äº‹ç•«åœ¨ä¸€å¼µç´™ä¸Šï¼Œç„¶å¾Œæ‰æ‰ï¼","è½è½å‘¨åœæœ‰ä»€éº¼è²éŸ³ï¼Ÿæ˜¯é¢¨è²é‚„æ˜¯é³¥å«è²ï¼Ÿ","å¦‚æœæƒ³å¤§å«ï¼Œå¯ä»¥è©¦è‘—å°æ•é ­å¤§å«ä¸€è²ã€‚","åšäº”æ¬¡æ…¢æ…¢çš„æ·±å‘¼å¸ï¼Œå¸æ°£ï½åæ°£ï½","æƒ³åƒä½ æ˜¯ä¸€æ£µå¤§æ¨¹ï¼Œæ ¹æ·±æ·±åœ°æŠ“ä½æ³¥åœŸã€‚","æŠŠä½ çš„æ‰‹æ”¾åœ¨è‚šå­ä¸Šï¼Œæ„Ÿè¦ºå®ƒéš¨è‘—å‘¼å¸èµ·ä¼ã€‚","å…ˆé›¢é–‹ç¾å ´ä¸€ä¸‹ä¸‹ï¼Œå»æ•£æ•£æ­¥å§ã€‚","å‘Šè¨´è€å¸«æˆ–å¤§äººä½ éœ€è¦å¹«å¿™ï¼Œé€™å¾ˆå‹‡æ•¢å–”ã€‚","è©¦è‘—ææè»Ÿè»Ÿçš„æ±è¥¿ï¼Œåƒæ˜¯å£“åŠ›çƒæˆ–é»åœŸã€‚","ç¾åœ¨ä¸è¦åšæ±ºå®šï¼Œå…ˆä¼‘æ¯ä¸€ä¸‹å†èªªã€‚","ä½ å¯ä»¥å“­ï¼Œçœ¼æ·šæœƒå¹«ä½ æŠŠå£“åŠ›å¸¶èµ°ã€‚","æŠŠè‚©è†€è³èµ·ä¾†ï¼Œå†ç”¨åŠ›æ”¾ä¸‹ä¾†ï¼ŒæŠŠé‡æ“”ä¸Ÿæ‰ã€‚","æ‰¾ä¸€æœ¬å–œæ­¡çš„æ›¸ï¼Œç¿»ä¸€ç¿»è®“å¿ƒéœä¸‹ä¾†ã€‚","ç”¨å†·æ°´æ²–æ²–æ‰‹è…•ï¼Œæœƒæ„Ÿè¦ºæ¯”è¼ƒèˆ’æœå–”ã€‚","æƒ³åƒä¸€å€‹å®‰å…¨çš„åœ°æ–¹ï¼Œä½ æ˜¯é‚£è£¡çš„åœ‹ç‹æˆ–å¥³ç‹ã€‚","è·Ÿè‡ªå·±èªªï¼šã€Œç¾åœ¨æ²’äº‹äº†ï¼Œæˆ‘å¾ˆå®‰å…¨ã€‚ã€","åœä¸‹ä¾†ï¼Œè§€å¯Ÿèº«é‚Šæœ‰ä»€éº¼ç´…è‰²çš„æ±è¥¿ï¼Ÿ"]},yellow:{color:"from-yellow-300 to-orange-300",icon:"âœ¨",messages:["ä½ ä»Šå¤©é–ƒé–ƒç™¼å…‰è€¶ï¼åƒæ˜Ÿæ˜Ÿä¸€æ¨£ã€‚","æŠŠé€™ä»½é–‹å¿ƒå‚³æŸ“çµ¦åˆ¥äººå§ï¼Œç¬‘ä¸€å€‹ï¼","å¤ªæ£’äº†ï¼çµ¦è‡ªå·±ä¸€å€‹å¤§å¤§çš„æŒè²ã€‚","è©¦è‘—æŠŠé€™ä»½èƒ½é‡ç”¨ä¾†å¹«åŠ©ä¸€å€‹æœ‹å‹ã€‚","æŠŠä½ ç¾åœ¨é€™éº¼æ£’çš„å¿ƒæƒ…ç•«ä¸‹ä¾†å§ï¼","è·Ÿæ—é‚Šçš„äººæ“ŠæŒï¼Œåˆ†äº«ä½ çš„å¥½é‹æ°£ã€‚","ä½ ç¾åœ¨å……æ»¿é›»åŠ›ï¼å¯ä»¥å»æŒ‘æˆ°ä¸€ä»¶é›£äº‹å–”ã€‚","è·³ä¸€æ”¯é–‹å¿ƒçš„èˆå§ï¼Œæ–æ“ºä½ çš„èº«é«”ï¼","å°è‘—é¡å­åšä¸€å€‹è¶…ç´šå¥½ç¬‘çš„é¬¼è‡‰ã€‚","è¶•å¿«æŠŠä½ æƒ³åˆ°çš„å¥½é»å­è¨˜éŒ„ä¸‹ä¾†ã€‚","ä½ çš„ç¬‘å®¹æ˜¯ä»Šå¤©æœ€æ£’çš„ç¦®ç‰©ã€‚","è©¦è‘—ç”¨é€™ä»½æ´»åŠ›å»æ•´ç†ä½ çš„æ›¸åŒ…æˆ–æˆ¿é–“ã€‚","è·Ÿå¥½æœ‹å‹åˆ†äº«ä¸€å€‹å¥½ç¬‘çš„ç¬‘è©±ã€‚","ç¾åœ¨çš„ä½ ï¼Œå¥½åƒè¶…äººä¸€æ¨£å²å®³å‘¢ï¼","æŠŠä½ çš„å¿«æ¨‚è®Šæˆä¸€å¥è®šç¾ï¼Œé€çµ¦åˆ¥äººã€‚","ä½ å°±åƒä¸€é¡†å……æ»¿æ°£æ³¡çš„æ±½æ°´ï¼Œå¥½æœ‰æ´»åŠ›ï¼","åˆ©ç”¨é€™ä»½èƒ½é‡ï¼Œå»å®Œæˆä½ ä¸€ç›´æƒ³åšçš„äº‹å§ã€‚","å¤§è²å”±ä¸€é¦–ä½ å–œæ­¡çš„æ­Œï¼Œå•¦å•¦å•¦ï½","å»æ“å ´è·‘ä¸€è·‘ï¼Œäº«å—é¢¨å¹éè‡‰çš„æ„Ÿè¦ºã€‚","ä½ çš„ç†±æƒ…å¯ä»¥èåŒ–å†°æ·‡æ·‹å–”ï¼","è¨˜å¾—é€™ç¨®é–‹å¿ƒçš„æ„Ÿè¦ºï¼ŒæŠŠå®ƒå­˜åœ¨å¿ƒè£¡ã€‚","ä»Šå¤©æ˜¯ä½ ç™¼å…‰ç™¼ç†±çš„æ—¥å­ï¼Œç›¡æƒ…å±•ç¾å§ï¼","è©¦è‘—æ•™åŒå­¸ä½ æœƒçš„æ±è¥¿ï¼Œç•¶å€‹å°è€å¸«ã€‚","ä½ çš„æ­£èƒ½é‡è®“å‘¨åœéƒ½è®Šäº®äº†å‘¢ã€‚","é€™éº¼é–‹å¿ƒçš„æ™‚åˆ»ï¼Œå€¼å¾—æ‹æ‰‹æ…¶ç¥ä¸€ä¸‹ï¼","æŠŠé€™ä»½èˆˆå¥®è®Šæˆå‰µä½œçš„å‹•åŠ›å§ã€‚","ä½ æ˜¯å¤§å®¶çš„é–‹å¿ƒæœï¼Œè¬è¬ä½ çš„ç¬‘å®¹ã€‚","æ·±å‘¼å¸ï¼ŒæŠŠéå¤šçš„èˆˆå¥®ç¨å¾®æ”¶ä¸€é»å›ä¾†ã€‚","ä»Šå¤©é‹æ°£çœŸå¥½ï¼Œè¦ä¸è¦è¨±å€‹é¡˜æœ›ï¼Ÿ","ä¿æŒé€™ä»½ç†±æƒ…ï¼Œæ˜å¤©ä¹Ÿæœƒå¾ˆæ£’çš„ï¼"]},blue:{color:"from-blue-300 to-indigo-300",icon:"ğŸ§¸",messages:["æŠ±æŠ±ç©å¶ï¼Œä¼‘æ¯ä¸€ä¸‹ï¼Œæ²’é—œä¿‚çš„ã€‚","æ…¢æ…¢ä¾†å°±å¥½ï¼Œä¸ç”¨æ€¥è‘—å¥½èµ·ä¾†ã€‚","è½é¦–æº«æŸ”çš„æ­Œï¼Œè®“éŸ³æ¨‚é™ªä¼´ä½ ã€‚","æƒ³å“­å°±å“­å‡ºä¾†å§ï¼Œçœ¼æ·šæ˜¯å¿ƒéˆçš„é›¨æ°´ã€‚","çµ¦è‡ªå·±ä¸€å€‹æº«æš–çš„æ“æŠ±ï¼Œä½ å·²ç¶“å¾ˆåŠªåŠ›äº†ã€‚","ç´¯äº†å°±è¶´ä¸€ä¸‹ï¼Œåƒå°è²“å’ªä¸€æ¨£ç¡å€‹è¦ºã€‚","ä½ ä¸å­¤å–®ï¼Œæ‰¾ä¸€ä½ä¿¡ä»»çš„äººèŠèŠå§ã€‚","é€™ä¸æ˜¯ä½ çš„éŒ¯ï¼Œå°è‡ªå·±æº«æŸ”ä¸€é»å–”ã€‚","å–æ¯ç†±ç†±çš„ç‰›å¥¶æˆ–å¯å¯ï¼Œæš–æš–èº«é«”ã€‚","å°±åƒå¤©ç©ºæœ‰æ™‚å€™æœƒä¸‹é›¨ï¼Œå¿ƒæƒ…ä¹Ÿæœƒæœ‰é›¨å¤©ã€‚","è£¹åœ¨æ£‰è¢«è£¡ï¼ŒæŠŠè‡ªå·±åŒ…æˆä¸€å€‹å£½å¸å·ã€‚","çœ‹è‘—é›²æœµæ…¢æ…¢é£„éï¼Œä»€éº¼éƒ½ä¸ç”¨æƒ³ã€‚","å¯«ä¸‹ä½ çš„é›£éï¼Œè®“ç´™æ¢å¹«ä½ åˆ†æ“”é‡é‡ã€‚","å»æ‘¸æ‘¸å¯µç‰©æˆ–æ˜¯è»Ÿè»Ÿçš„æ¯¯å­ã€‚","å…è¨±è‡ªå·±ä»Šå¤©ä»€éº¼äº‹éƒ½ä¸åšã€‚","é–‰ä¸Šçœ¼ç›ï¼Œæƒ³åƒä½ åœ¨è»Ÿç¶¿ç¶¿çš„é›²æœµä¸Šã€‚","é›£éçš„æ™‚å€™ï¼Œå¿ƒæ­£åœ¨æ‚„æ‚„åœ°ä¿®å¾©è‡ªå·±å–”ã€‚","ä½ æ˜¯è¢«æ„›è‘—çš„ï¼Œå³ä½¿ç¾åœ¨æ„Ÿè¦ºä¸åˆ°ã€‚","æ‰¾ä¸€æœ¬æœ‰æ¼‚äº®åœ–ç‰‡çš„æ›¸ï¼Œéš¨æ„ç¿»ç¿»ã€‚","å»æ›¬æ›¬å¤ªé™½ï¼Œè®“é™½å…‰çµ¦ä½ ä¸€é»é»åŠ›é‡ã€‚","ç•«ä¸€å¹…è—è‰²çš„ç•«ï¼ŒæŠŠæ†‚é¬±éƒ½ç•«å‡ºä¾†ã€‚","è¼•è¼•æ‹æ‹è‡ªå·±çš„èƒ¸å£ï¼Œèªªè²ã€Œæ²’äº‹äº†ã€ã€‚","å¦‚æœä¸æƒ³èªªè©±ï¼Œå®‰éœåœ°å¾…è‘—ä¹Ÿå¾ˆå¥½ã€‚","çœ¼æ·šæµä¹¾äº†ï¼Œå¿ƒå°±æœƒæ…¢æ…¢æ”¾æ™´çš„ã€‚","æ¯ä¸€å€‹æƒ…ç·’éƒ½æ˜¯ä½ çš„æœ‹å‹ï¼Œè—è‰²ä¹Ÿæ˜¯ã€‚","åªè¦å‘¼å¸å°±å¥½ï¼Œä½ å·²ç¶“åšå¾—å¤ å¥½äº†ã€‚","æ‰¾ä¸€å€‹è®“ä½ æœ‰å®‰å…¨æ„Ÿçš„å°è§’è½å¾…è‘—ã€‚","æ…¢æ…¢å–æ°´ï¼Œæ„Ÿè¦ºæ°´æµé€²èº«é«”çš„æ¯ä¸€å€‹è§’è½ã€‚","ä»Šå¤©å°±ç•¶ä½œæ˜¯å¿ƒéˆçš„æ”¾å‡æ—¥å§ã€‚","é›¨å¾Œç¸½æœƒçœ‹è¦‹å½©è™¹ï¼Œæ…¢æ…¢ç­‰å¾…å°±å¥½ã€‚"]},green:{color:"from-green-300 to-teal-300",icon:"ğŸŒ±",messages:["äº«å—ç¾åœ¨çš„å¹³éœï¼Œé€™æ˜¯ä¸€ä»½çè²´çš„ç¦®ç‰©ã€‚","ä½ æ˜¯æœ€æ£’çš„ï¼Œè«‹ç¹¼çºŒä¿æŒé€™ä»½ç©©å®šã€‚","è§€å¯Ÿèº«é‚Šçš„å°èŠ±å°è‰ï¼Œå®ƒå€‘ä¹Ÿåœ¨å®‰éœç”Ÿé•·ã€‚","ç¾åœ¨çš„ä½ é ­è…¦å¾ˆæ¸…æ¥šï¼Œé©åˆè®€æœ¬å¥½æ›¸ã€‚","è¬è¬è‡ªå·±ä»Šå¤©éå¾—é€™éº¼å®‰ç©©ã€‚","ç”¨é€™ä»½å¹³éœçš„å¿ƒæƒ…ï¼Œå»å¹«åŠ©éœ€è¦çš„äººã€‚","é–‰ä¸Šçœ¼ç›ä¸€åˆ†é˜ï¼Œè½è½å‘¨åœå®‰éœçš„è²éŸ³ã€‚","ä½ ç¾åœ¨å¾ˆå®‰å…¨ï¼Œä¹Ÿå¾ˆæ”¾é¬†ï¼ŒçœŸå¥½ã€‚","ä¿æŒé€™ä»½å¹³å’Œçš„å¿ƒï¼Œç¹¼çºŒæ¥ä¸‹ä¾†çš„æ´»å‹•ã€‚","è©¦è‘—åšä¸€å€‹æ·±é•·çš„å‘¼å¸ï¼ŒæŠŠå¹³éœå¸é€²ä¾†ã€‚","ä½ çš„å¿ƒåƒå¹³éœçš„æ¹–æ°´ä¸€æ¨£ç¾éº—ã€‚","å°ˆæ³¨åœ¨æ‰‹é‚Šçš„äº‹æƒ…ä¸Šï¼Œä½ æœƒåšå¾—å¾ˆå¥½çš„ã€‚","é€™æ˜¯ä¸€å€‹é©åˆå­¸ç¿’å’Œæ€è€ƒçš„å¥½æ™‚æ©Ÿã€‚","çµ¦æ—é‚Šçš„äººä¸€å€‹æº«æš–çš„å¾®ç¬‘å§ã€‚","æ…¢æ…¢åœ°å–ä¸€å£èŒ¶ï¼Œå“åšå®ƒçš„å‘³é“ã€‚","ä½ åƒä¸€æ£µç©©é‡çš„å°æ¨¹ï¼Œå®‰éœè€Œå¼·å¤§ã€‚","å¯«ä¸‹ä¸€ä»¶ä½ ä»Šå¤©è¦ºå¾—æ„Ÿè¬çš„äº‹æƒ…ã€‚","æ•´ç†ä¸€ä¸‹æ¡Œå­ï¼Œè®“ç’°å¢ƒè·Ÿä½ å¿ƒè£¡ä¸€æ¨£æ•´é½Šã€‚","ä¼¸å±•ä¸€ä¸‹èº«é«”ï¼Œæ„Ÿè¦ºè‚Œè‚‰æ…¢æ…¢æ”¾é¬†ã€‚","è½è½ç™½å™ªéŸ³æˆ–å¤§è‡ªç„¶çš„è²éŸ³ï¼Œäº«å—ç•¶ä¸‹ã€‚","ä½ ç¾åœ¨çš„ç‹€æ…‹å¾ˆå®Œç¾ï¼Œä¸éœ€è¦æ”¹è®Šä»€éº¼ã€‚","ç”¨æº«æŸ”çš„çœ¼ç¥çœ‹çœ‹é€™å€‹ä¸–ç•Œã€‚","æŠŠé€™ä»½å®‰å®šçš„åŠ›é‡å¸¶çµ¦æœ‰äº›æ…Œå¼µçš„æœ‹å‹ã€‚","åƒçƒé¾œä¸€æ¨£æ…¢æ…¢èµ°ï¼Œä¹Ÿèƒ½åˆ°é”çµ‚é»å–”ã€‚","æ¬£è³ä¸€ä¸‹çª—å¤–çš„é¢¨æ™¯ï¼Œçœ‹çœ‹æ¨¹è‘‰çš„æ“ºå‹•ã€‚","è¼•è¼•åœ°æŠŠäº‹æƒ…ä¸€ä»¶ä¸€ä»¶å®Œæˆã€‚","å¿ƒå¹³æ°£å’Œçš„ä½ ï¼Œçœ‹èµ·ä¾†å¾ˆæœ‰æ™ºæ…§å‘¢ã€‚","æ„Ÿå—è…³åº•èˆ‡åœ°æ¿çš„æ¥è§¸ï¼Œç©©ç©©åœ°ç«™è‘—ã€‚","æŠŠé€™ä»½èˆ’æœçš„æ„Ÿè¦ºè¨˜ä¸‹ä¾†ï¼Œä¸‹æ¬¡å¯ä»¥ç”¨ã€‚","ä½ åšå¾—å¾ˆå¥½ï¼Œå°±é€™æ¨£ç©©ç©©åœ°å‰é€²å§ã€‚"]},random:{color:"from-purple-300 to-pink-300",icon:"ğŸ’–",messages:["ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ¯”æƒ³åƒä¸­æ›´å‹‡æ•¢ï¼","ä»Šå¤©ä¹Ÿæ˜¯ç¾å¥½çš„ä¸€å¤©ï¼Œæœƒæœ‰å¥½äº‹ç™¼ç”Ÿã€‚","è¨˜å¾—å°è‡ªå·±å¥½ä¸€é»ï¼Œä½ å€¼å¾—è¢«æ„›ã€‚","ä¸€å€‹å°å°çš„å¾®ç¬‘ï¼Œå¯ä»¥æ”¹è®Šæ•´å€‹ä¸–ç•Œå–”ã€‚","ä½ æ˜¯ç¨ä¸€ç„¡äºŒçš„å¯¶è—ï¼Œæ²’äººèƒ½å–ä»£ä½ ã€‚","æ·±å‘¼å¸ï¼Œä¸€åˆ‡éƒ½æœƒå¥½èµ·ä¾†çš„ã€‚","åˆ¥å¿˜äº†ï¼Œå®‡å®™æ­£åœ¨å·å·å¹«ä½ åŠ æ²¹ï¼","ä½ çš„åŠªåŠ›ï¼Œå¤§å®¶éƒ½æœ‰çœ‹åˆ°å–”ã€‚","é€ä½ ä¸€é¡†éš±å½¢çš„å¹¸é‹æ˜Ÿï¼Œæ¥ä½ï¼","ä»Šå¤©çš„ä½ ï¼Œçœ‹èµ·ä¾†ç‰¹åˆ¥å¯æ„›å‘¢ã€‚","è·Œå€’äº†ä¹Ÿæ²’é—œä¿‚ï¼Œç«™èµ·ä¾†æ‹æ‹ç°å¡µå°±å¥½ã€‚","ä½ æ˜¯è‡ªå·±çš„é­”æ³•å¸«ï¼Œå¯ä»¥å‰µé€ å¥‡è¹Ÿã€‚","æ¯ä¸€å€‹æ–°çš„é–‹å§‹ï¼Œéƒ½å……æ»¿äº†å¸Œæœ›ã€‚","åƒå‘æ—¥è‘µä¸€æ¨£ï¼Œç¸½æ˜¯é¢å‘é™½å…‰å§ã€‚","ä½ çš„å­˜åœ¨ï¼Œå°±æ˜¯çµ¦ä¸–ç•Œæœ€æ£’çš„ç¦®ç‰©ã€‚","ä¸è¦å®³æ€•çŠ¯éŒ¯ï¼Œé‚£æ˜¯å­¸ç¿’çš„æ©Ÿæœƒå‘€ã€‚","çµ¦è‡ªå·±ä¸€é»æ™‚é–“ï¼Œä½ æœƒæ…¢æ…¢é•·å¤§çš„ã€‚","å¿ƒè£¡æœ‰æ„›ï¼Œçœ‹å‡ºå»çš„ä¸–ç•Œå°±æœƒæ˜¯ç²‰ç´…è‰²çš„ã€‚","åªè¦ä½ é¡˜æ„ï¼Œéš¨æ™‚éƒ½å¯ä»¥é‡æ–°å‡ºç™¼ã€‚","æƒ³åšä»€éº¼å°±å»è©¦è©¦çœ‹å§ï¼Œå‹‡æ°£æœƒé™ªè‘—ä½ ã€‚","ä½ çš„å–„è‰¯ï¼Œæœƒæº«æš–èº«é‚Šçš„æ¯ä¸€å€‹äººã€‚","å³ä½¿æ˜¯å°å°çš„é€²æ­¥ï¼Œä¹Ÿéå¸¸å€¼å¾—æ…¶ç¥ã€‚","æŠ¬é ­çœ‹çœ‹å¤©ç©ºï¼Œä¸–ç•Œå¥½å¤§ï¼Œç…©æƒ±å¥½å°ã€‚","ä½ æ˜¯è¢«æ·±æ·±æ„›è‘—çš„ï¼Œæ°¸é ä¸è¦å¿˜è¨˜ã€‚","æ¯å¤©æ‰¾ä¸€ä»¶é–‹å¿ƒçš„å°äº‹ï¼Œå­˜é€²å¿ƒè£¡çš„å­˜éŒ¢ç­’ã€‚","åªè¦ä½ ä¸æ”¾æ£„ï¼Œå¤¢æƒ³å°±æœƒæ…¢æ…¢é è¿‘ã€‚","ä½ çš„è²éŸ³å¾ˆé‡è¦ï¼Œå‹‡æ•¢èªªå‡ºä½ çš„æƒ³æ³•ã€‚","åƒå°è‰ä¸€æ¨£å¼·éŸŒï¼Œé¢¨å¹é›¨æ‰“ä¹Ÿä¸æ€•ã€‚","ä½ æ˜¯æœ€æ£’çš„ï¼Œç„¡è«–ç™¼ç”Ÿä»€éº¼äº‹ã€‚","ä»Šå¤©ï¼Œçµ¦è‡ªå·±ä¸€å€‹å¤§å¤§çš„æ“æŠ±å§ï¼"]}};

        // DOM Elements
        const emotionForm = document.getElementById('emotion-form');
        const studentNameInput = document.getElementById('student-name');
        const reasonInput = document.getElementById('reason-input');
        const zoneTypeInput = document.getElementById('zone-type-input');
        const emotionSelectionContainer = document.getElementById('emotion-selection-container');
        const errorMessage = document.getElementById('error-message');
        const guideContainer = document.getElementById('guide-container');
        const rainbowModal = document.getElementById('rainbow-card-modal');
        const cardContainer = document.getElementById('card-container');
        const closeCardBtn = document.getElementById('close-card-btn');
        const cardHeaderBg = document.getElementById('card-header-bg');
        const cardIcon = document.getElementById('card-icon');
        const cardTitle = document.getElementById('card-title');
        const cardMessage = document.getElementById('card-message');
        const readCardBtn = document.getElementById('read-card-btn');
        const manualDrawBtn = document.getElementById('manual-draw-btn');
        const gaugePointer = document.getElementById('main-gauge-pointer');
        const personalGaugePointer = document.getElementById('personal-gauge-pointer');
        const personalGaugeText = document.getElementById('personal-gauge-text');
        const clearAllBtn = document.getElementById('clear-all-btn');
        const toggleBtn = document.getElementById('toggle-view-btn');
        const inputPanel = document.getElementById('input-panel');
        const quadrantPanel = document.getElementById('quadrant-panel');
        const toggleHint = document.getElementById('toggle-hint');
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const iconLocked = document.getElementById('icon-locked');
        const iconUnlocked = document.getElementById('icon-unlocked');

        // Admin Flag
        let isAdmin = localStorage.getItem('chiikawa_admin') === 'true';
        updateAdminUI();

        function initializeUI() {
            const zoneOptionsContainer = document.getElementById('zone-options');
            emotionZones.forEach(zone => {
                const button = document.createElement('button');
                button.type = 'button';
                button.dataset.id = zone.id;
                button.className = `p-4 rounded-2xl border-2 font-bold transition-all duration-200 flex flex-col items-center justify-center gap-1 ${zone.color} ${zone.textColor} hover:scale-[1.02] active:scale-95 chiikawa-btn`;
                button.innerHTML = `<span class="text-lg">${zone.name}</span><span class="text-xs bg-white/60 px-2 py-0.5 rounded-full font-black">${zone.action}</span>`;
                zoneOptionsContainer.appendChild(button);
                const guideDiv = document.createElement('div');
                guideDiv.className = `p-4 rounded-2xl border-2 ${zone.color}`;
                guideDiv.innerHTML = `<p class="font-bold ${zone.textColor} flex items-center gap-2">â— ${zone.name}</p><p class="text-slate-600 text-sm mt-1 font-medium">${zone.description}</p>`;
                guideContainer.appendChild(guideDiv);
            });
        }

        function sendToGAS(action, payload = {}) {
            const formData = new FormData();
            formData.append('action', action);
            for (const key in payload) {
                formData.append(key, payload[key]);
            }
            return fetch(GAS_API_URL, {
                method: 'POST',
                body: formData,
                mode: 'no-cors' 
            });
        }

        async function fetchFromGAS() {
            try {
                const response = await fetch(`${GAS_API_URL}?action=read`);
                const data = await response.json();
                return data;
            } catch (e) {
                console.error("Fetch Error:", e);
                return [];
            }
        }

        function updateAdminUI() {
            if(isAdmin) {
                clearAllBtn.classList.remove('hidden');
                iconLocked.classList.add('hidden');
                iconUnlocked.classList.remove('hidden');
                adminLoginBtn.title = "é»æ“Šç™»å‡º";
            } else {
                clearAllBtn.classList.add('hidden');
                iconLocked.classList.remove('hidden');
                iconUnlocked.classList.add('hidden');
                adminLoginBtn.title = "è€å¸«ç™»å…¥";
            }
            if(!quadrantPanel.classList.contains('hidden')) fetchDataAndUpdateUI();
        }

        adminLoginBtn.addEventListener('click', () => {
            if(isAdmin) {
                if(confirm("ç¢ºå®šè¦ç™»å‡ºç®¡ç†å“¡æ¨¡å¼å—ï¼Ÿ")) {
                    isAdmin = false;
                    localStorage.removeItem('chiikawa_admin');
                    updateAdminUI();
                    alert("å·²ç™»å‡ºï¼");
                }
            } else {
                const password = prompt("è«‹è¼¸å…¥è€å¸«å¯†ç¢¼ï¼š");
                if(password === ADMIN_PASSWORD) {
                    isAdmin = true;
                    localStorage.setItem('chiikawa_admin', 'true');
                    updateAdminUI();
                    alert("ç™»å…¥æˆåŠŸï¼åƒåœ¾æ¡¶å·²å‡ºç¾ã€‚");
                } else if(password !== null) {
                    alert("å¯†ç¢¼éŒ¯èª¤ï¼");
                }
            }
        });

        function updateGauge(zoneId) {
            let rotation = -90;
            switch(zoneId) {
                case 'blue': rotation = -67.5; break;
                case 'green': rotation = -22.5; break;
                case 'yellow': rotation = 22.5; break;
                case 'red': rotation = 67.5; break;
            }
            if(gaugePointer) gaugePointer.style.transform = `rotate(${rotation}deg)`;
        }
        
        function updatePersonalGauge(zoneId) {
            let rotation = -90;
            const zone = emotionZones.find(z => z.id === zoneId);
            if(!zone) return;
            switch(zoneId) {
                case 'blue': rotation = -67.5; break;
                case 'green': rotation = -22.5; break;
                case 'yellow': rotation = 22.5; break;
                case 'red': rotation = 67.5; break;
            }
            if(personalGaugePointer) personalGaugePointer.style.transform = `rotate(${rotation}deg)`;
            if(personalGaugeText) {
                personalGaugeText.textContent = `ç¾åœ¨æŒ‡é‡æŒ‡å‘ï¼š${zone.name}ï¼`;
                personalGaugeText.className = `text-sm font-bold transition-colors ${zone.textColor}`;
            }
        }

        function openRainbowCard(zoneId, reasonText = "") {
            const category = zoneId && rainbowCards[zoneId] ? rainbowCards[zoneId] : rainbowCards['random'];
            const randomMsg = category.messages[Math.floor(Math.random() * category.messages.length)];
            let finalMessage = randomMsg;
            if (reasonText && reasonText.trim() !== "") {
                finalMessage = `é—œæ–¼ã€Œ${reasonText.trim()}ã€é€™ä»¶äº‹...\n\nå‰ä¼Šå¡å“‡æƒ³å°ä½ èªªï¼š\n${randomMsg}`;
            }
            cardHeaderBg.className = `h-28 bg-gradient-to-r ${category.color} flex items-center justify-center relative`;
            cardIcon.textContent = category.icon;
            cardTitle.textContent = zoneId ? (reasonText ? "å°ˆå±¬è™•æ–¹ç±¤" : "å°è™•æ–¹") : "å®‡å®™è¨Šæ¯";
            cardMessage.textContent = finalMessage;
            cardContainer.classList.remove('flipped');
            rainbowModal.classList.remove('hidden');
            setTimeout(() => rainbowModal.classList.remove('opacity-0'), 10);
        }

        function closeRainbowCard() {
            rainbowModal.classList.add('opacity-0');
            setTimeout(() => rainbowModal.classList.add('hidden'), 300);
        }

        function readAloud(text) { 
            if (!window.speechSynthesis) return; 
            window.speechSynthesis.cancel(); 
            const u = new SpeechSynthesisUtterance(text); 
            u.lang = 'zh-TW'; 
            window.speechSynthesis.speak(u); 
        }

        let pollingInterval;
        function startPolling() {
            fetchDataAndUpdateUI();
            pollingInterval = setInterval(fetchDataAndUpdateUI, 5000); 
        }
        function stopPolling() {
            clearInterval(pollingInterval);
        }

        async function fetchDataAndUpdateUI() {
            if (quadrantPanel.classList.contains('hidden')) return;

            const data = await fetchFromGAS();
            const lists = { red: document.getElementById('list-red'), yellow: document.getElementById('list-yellow'), blue: document.getElementById('list-blue'), green: document.getElementById('list-green') };
            
            Object.values(lists).forEach(list => list.innerHTML = '');
            let counts = { red: 0, yellow: 0, blue: 0, green: 0 };
            let total = 0;
            let latestItem = null;
            if (data.length > 0) { latestItem = data[data.length - 1]; }

            [...data].reverse().forEach(item => {
                const zone = emotionZones.find(z => z.id === item.zone);
                if (!zone) return;

                const div = document.createElement('div');
                div.className = `bg-white p-2 rounded-lg shadow-sm text-sm border-l-4 ${zone.textColor.replace('text', 'border')} animate-pop-in relative group`;
                const emotionDisplayName = item.emotion === 'other' ? 'å…¶ä»–' : zone.emotions.find(e => e.id === item.emotion)?.name || item.emotion;
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div><span class="font-bold">${item.name}</span> <span class="text-xs text-gray-400">è¦ºå¾—</span> <span class="font-bold ${zone.textColor}">${emotionDisplayName}</span></div>
                        <div class="flex gap-1">
                            <button class="read-card-btn-mini p-1 text-slate-300 hover:text-indigo-400 rounded-full hover:bg-slate-50" data-text="${item.name} è¦ºå¾— ${emotionDisplayName}">ğŸ”Š</button>
                            ${isAdmin ? `<button class="delete-btn p-1 text-slate-300 hover:text-red-400 rounded-full hover:bg-red-50" data-id="${item.id}">âœ•</button>` : ''}
                        </div>
                    </div>
                    ${item.reason ? `<p class="text-xs text-slate-500 mt-1 pl-1">"${item.reason}"</p>` : ''}
                `;
                lists[item.zone].appendChild(div);
                counts[item.zone]++;
                total++;
            });

            if (latestItem) updateGauge(latestItem.zone);

            Object.keys(counts).forEach(zone => {
                const count = counts[zone];
                const percentage = total === 0 ? 0 : (count / total) * 100;
                const bar = document.getElementById(`bar-${zone}`);
                if(bar) bar.style.width = `${percentage}%`;
                const countEl = document.getElementById(`count-${zone}`);
                if(countEl) countEl.textContent = count;
            });
        }

        toggleBtn.addEventListener('click', () => {
            inputPanel.classList.toggle('hidden');
            quadrantPanel.classList.toggle('hidden');
            toggleHint.classList.add('hidden');
            if (!quadrantPanel.classList.contains('hidden')) {
                startPolling();
            } else {
                stopPolling();
            }
        });

        document.getElementById('zone-options').addEventListener('click', e => {
            const button = e.target.closest('button');
            if (!button) return;
            const selectedZoneId = button.dataset.id;
            const selectedZone = emotionZones.find(z => z.id === selectedZoneId);
            zoneTypeInput.value = selectedZoneId;
            
            document.querySelectorAll('#zone-options button').forEach(btn => {
                const z = emotionZones.find(zz => zz.id === btn.dataset.id);
                btn.className = `p-4 rounded-2xl border-2 font-bold transition-all duration-200 flex flex-col items-center justify-center gap-1 ${z.color} ${z.textColor} hover:scale-[1.02] active:scale-95 chiikawa-btn`;
                if(btn.dataset.id === selectedZoneId) {
                    btn.className += ` ${z.selectedColor} btn-selected`;
                }
            });
            
            updatePersonalGauge(selectedZoneId);
            
            emotionSelectionContainer.innerHTML = `
                <label class="font-bold text-slate-700 block mb-3 flex items-center gap-2">
                    <span class="bg-pink-400 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm shadow-md font-black">1b</span>
                    å…·é«”æ„Ÿå—æ˜¯ï¼Ÿ
                </label>
                <div class="emotion-btn-group grid grid-cols-3 gap-3">
                    ${selectedZone.emotions.map(emo => `
                        <button type="button" data-id="${emo.id}" class="emotion-btn py-3 px-2 rounded-xl border-2 font-bold text-sm transition-all duration-200 ${selectedZone.color} ${selectedZone.textColor} hover:bg-white text-center flex items-center justify-center h-14">
                            ${emo.name}
                        </button>
                    `).join('')}
                </div>
                <div id="custom-emotion-wrapper" class="hidden mt-3">
                    <input type="text" id="custom-emotion-input" class="w-full p-3 bg-white border-2 border-slate-200 rounded-xl focus:ring-4 focus:ring-indigo-100" placeholder="è«‹æè¿°...">
                </div>
                <input type="hidden" id="emotion-type-input">`;
            setTimeout(() => emotionSelectionContainer.querySelector('.emotion-btn-group')?.classList.add('visible'), 10);
        });

        emotionSelectionContainer.addEventListener('click', e => {
            const button = e.target.closest('.emotion-btn');
            if (!button) return;
            const id = button.dataset.id;
            const zone = emotionZones.find(z => z.id === zoneTypeInput.value);
            document.getElementById('emotion-type-input').value = id;
            document.querySelectorAll('.emotion-btn').forEach(btn => btn.className = `emotion-btn py-3 px-2 rounded-xl border-2 font-bold text-sm transition-all duration-200 ${btn.dataset.id === id ? zone.selectedColor : zone.color + ' ' + zone.textColor} text-center flex items-center justify-center h-14`);
            const wrapper = document.getElementById('custom-emotion-wrapper');
            if (id === 'other') { wrapper.classList.remove('hidden'); document.getElementById('custom-emotion-input').focus(); }
            else { wrapper.classList.add('hidden'); readAloud(button.textContent.trim()); }
        });

        emotionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMessage.textContent = '';
            const btn = document.getElementById('submit-btn');
            const zone = zoneTypeInput.value;
            const emotion = document.getElementById('emotion-type-input')?.value;
            const name = studentNameInput.value.trim();
            const reason = reasonInput.value.trim();

            if (!zone || !emotion || !name) { errorMessage.textContent = 'è«‹å¡«å¯«å®Œæ•´å–”ï¼'; return; }

            openRainbowCard(zone, reason);
            updatePersonalGauge(zone);

            btn.disabled = true;
            btn.innerHTML = `<span class="animate-spin">ğŸ”„</span> ç´€éŒ„ä¸­...`;

            try {
                await sendToGAS('write', { name: name, zone: zone, emotion: emotion, reason: reason });
                emotionForm.reset();
                zoneTypeInput.value = '';
                emotionSelectionContainer.innerHTML = '';
                document.getElementById('zone-options').innerHTML = ''; 
                initializeUI(); 
            } catch (err) {
                console.error("Background Save Error:", err);
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>é€å‡ºå¿ƒæƒ…ï¼ŒæŠ½å–ç¥ç¦</span> <span class="animate-bounce">âœ¨</span>`;
            }
        });

        document.getElementById('emotion-lists').addEventListener('click', async (e) => {
            const readBtn = e.target.closest('.read-card-btn-mini');
            if (readBtn) { readAloud(readBtn.dataset.text); return; }
            const delBtn = e.target.closest('.delete-btn');
            if (delBtn && isAdmin) {
                if(!confirm('ç¢ºå®šåˆªé™¤é€™å¼µå¡ç‰‡ï¼Ÿ')) return;
                const id = delBtn.dataset.id;
                delBtn.closest('.group').remove();
                await sendToGAS('delete', { id: id });
            }
        });

        clearAllBtn.addEventListener('click', async () => {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºå…¨ç­è³‡æ–™å—ï¼Ÿç„¡æ³•å¾©åŸå–”ï¼')) return;
            document.querySelectorAll('#emotion-lists > div > div').forEach(div => div.innerHTML = '');
            await sendToGAS('delete', { id: 'all' });
            alert('å·²é€å‡ºæ¸…ç©ºæŒ‡ä»¤ï¼');
        });

        cardContainer.addEventListener('click', () => {
            if (!cardContainer.classList.contains('flipped')) {
                cardContainer.classList.add('flipped');
                setTimeout(() => readAloud(cardMessage.textContent), 600);
            }
        });
        closeCardBtn.addEventListener('click', closeRainbowCard);
        readCardBtn.addEventListener('click', (e) => { e.stopPropagation(); readAloud(cardMessage.textContent); });
        manualDrawBtn.addEventListener('click', () => openRainbowCard(null));

        initializeUI();
    </script>
</body>
</html>